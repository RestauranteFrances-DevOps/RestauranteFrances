name: Deploy to Azure AKS

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0
        
    - name: Debug - List all files
      run: |
        echo "=== LISTANDO TODOS OS ARQUIVOS ==="
        pwd
        ls -la
        echo "=== VERIFICANDO verification.txt ==="
        if [ -f verification.txt ]; then
          echo "âœ… verification.txt ENCONTRADO"
          cat verification.txt
        else
          echo "âŒ verification.txt NÃƒO ENCONTRADO - CRIANDO..."
          echo "Application verified: $(date)" > verification.txt
          cat verification.txt
        fi
        
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '14'
        
    - name: Install dependencies
      run: npm install
      
    - name: Run tests
      run: |
        echo "=== EXECUTANDO TESTES ==="
        npm test
        
    - name: Final verification
      run: |
        echo "=== VERIFICAÃ‡ÃƒO FINAL ==="
        test -f verification.txt && echo "ğŸ‰ verification.txt: EXISTE" || echo "ğŸ’¥ verification.txt: FALTANDO"
        test -f package.json && echo "ğŸ‰ package.json: EXISTE" || echo "ğŸ’¥ package.json: FALTANDO"
        npm run | grep test && echo "ğŸ‰ test script: EXISTE" || echo "ğŸ’¥ test script: FALTANDO"
        
    - name: Success
      run: echo "ğŸ‰ğŸ‰ğŸ‰ PIPELINE CI/CD CONCLUÃDO COM SUCESSO! ğŸ‰ğŸ‰ğŸ‰"
